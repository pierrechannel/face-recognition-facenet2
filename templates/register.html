<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Face Recognition System</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .hero-section {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            padding: 3rem 0;
            margin-bottom: 2rem;
        }
        .feature-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: #6a11cb;
        }
        .upload-area {
            border: 2px dashed #ccc;
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            margin-bottom: 1rem;
            transition: all 0.3s;
        }
        .upload-area:hover {
            border-color: #6a11cb;
            background-color: #f8f9fa;
        }
        .preview-image {
            max-width: 100%;
            max-height: 200px;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        .status-healthy {
            color: #198754;
        }
        .status-unhealthy {
            color: #dc3545;
        }
        .progress {
            height: 8px;
        }
        .image-preview-container {
            position: relative;
            display: inline-block;
            margin: 5px;
        }
        .remove-image {
            position: absolute;
            top: -10px;
            right: -10px;
            background: #dc3545;
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            text-align: center;
            line-height: 24px;
            cursor: pointer;
        }
        .api-endpoint {
            background-color: #f8f9fa;
            border-left: 4px solid #6a11cb;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fa-solid fa-face-smile me-2"></i>
                Face Recognition System
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="#health"><i class="fa-solid fa-heart-pulse me-1"></i> Health</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#register"><i class="fa-solid fa-user-plus me-1"></i> Register Face</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#batch"><i class="fa-solid fa-users me-1"></i> Batch Register</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#api"><i class="fa-solid fa-code me-1"></i> API Docs</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero-section">
        <div class="container text-center">
            <h1 class="display-4 fw-bold">Face Recognition System</h1>
            <p class="lead">Register and recognize faces using our advanced deep learning API</p>
            <div class="mt-4">
                <div class="spinner-border me-2" role="status" id="statusSpinner">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <span id="systemStatus">Checking system status...</span>
            </div>
        </div>
    </section>

    <!-- Main Content -->
    <div class="container">
        <!-- Health Check Section -->
        <section id="health" class="mb-5">
            <h2 class="mb-4"><i class="fa-solid fa-heart-pulse me-2"></i>System Health</h2>
            <div class="row">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header bg-transparent">
                            <h5 class="card-title">API Status</h5>
                        </div>
                        <div class="card-body">
                            <div id="healthStatus" class="text-center py-4">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                                <p class="mt-2">Checking API health...</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header bg-transparent">
                            <h5 class="card-title">System Information</h5>
                        </div>
                        <div class="card-body">
                            <ul class="list-group list-group-flush" id="systemInfo">
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    Device
                                    <span class="badge bg-primary rounded-pill" id="deviceInfo">Checking...</span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    Model Status
                                    <span class="badge bg-secondary rounded-pill" id="modelInfo">Checking...</span>
                                </li>
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    API Version
                                    <span class="badge bg-info rounded-pill">v1.0</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Register Face Section -->
        <section id="register" class="mb-5">
            <h2 class="mb-4"><i class="fa-solid fa-user-plus me-2"></i>Register Face</h2>
            <div class="card">
                <div class="card-header bg-transparent">
                    <h5 class="card-title">Register a New Person</h5>
                </div>
                <div class="card-body">
                    <form id="registerForm" enctype="multipart/form-data">
                        <div class="mb-3">
                            <label for="personName" class="form-label">Full Name</label>
                            <input type="text" class="form-control" id="personName" required placeholder="Enter person's name">
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Upload Face Images</label>
                            <div class="upload-area" id="uploadArea">
                                <i class="fa-solid fa-cloud-arrow-up fa-2x mb-2"></i>
                                <p>Drag & drop images here or click to browse</p>
                                <p class="text-muted small">Supported formats: JPG, PNG, JPEG, BMP</p>
                                <input type="file" id="fileInput" class="d-none" multiple accept=".jpg,.jpeg,.png,.bmp">
                                <button type="button" class="btn btn-primary" onclick="document.getElementById('fileInput').click()">
                                    Select Images
                                </button>
                            </div>
                            <div id="imagePreviews" class="d-flex flex-wrap mt-3"></div>
                        </div>
                        
                        <div class="mb-3">
                            <div class="form-text">For best results, upload multiple images with different angles and lighting conditions.</div>
                        </div>
                        
                        <button type="submit" class="btn btn-success" id="registerButton">
                            <i class="fa-solid fa-plus me-1"></i> Register Face
                        </button>
                    </form>
                    
                    <div class="mt-4 d-none" id="uploadProgress">
                        <p>Processing images...</p>
                        <div class="progress">
                            <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%"></div>
                        </div>
                        <div id="uploadStatus" class="mt-2 small"></div>
                    </div>
                    
                    <div class="alert alert-success mt-3 d-none" id="successAlert" role="alert"></div>
                    <div class="alert alert-danger mt-3 d-none" id="errorAlert" role="alert"></div>
                </div>
            </div>
        </section>

        <!-- Batch Register Section -->
        <section id="batch" class="mb-5">
            <h2 class="mb-4"><i class="fa-solid fa-users me-2"></i>Batch Registration</h2>
            <div class="card">
                <div class="card-header bg-transparent">
                    <h5 class="card-title">Register Multiple People</h5>
                </div>
                <div class="card-body">
                    <p class="text-muted">This feature allows you to register multiple people at once using JSON data. This endpoint is not fully implemented in the API yet.</p>
                    
                    <div class="alert alert-info">
                        <i class="fa-solid fa-info-circle me-1"></i>
                        <strong>Implementation Note:</strong> The batch endpoint requires additional implementation for base64/URL image handling in your backend.
                    </div>
                    
                    <form id="batchForm">
                        <div class="mb-3">
                            <label for="batchData" class="form-label">JSON Data</label>
                            <textarea class="form-control" id="batchData" rows="6" placeholder='{"name": "John Doe", "images": ["base64string1", "base64string2"]}'></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary" disabled>
                            <i class="fa-solid fa-database me-1"></i> Submit Batch Data
                        </button>
                    </form>
                </div>
            </div>
        </section>

        <!-- API Documentation Section -->
        <section id="api" class="mb-5">
            <h2 class="mb-4"><i class="fa-solid fa-code me-2"></i>API Documentation</h2>
            
            <div class="api-endpoint">
                <h5><span class="badge bg-success me-2">GET</span> /api/health</h5>
                <p>Check the health status of the API and system information.</p>
                <pre class="bg-light p-3 mt-3"><code>curl -X GET http://localhost:5000/api/health</code></pre>
            </div>
            
            <div class="api-endpoint">
                <h5><span class="badge bg-primary me-2">POST</span> /api/register</h5>
                <p>Register face images for a person. Accepts multipart/form-data with name and image files.</p>
                <pre class="bg-light p-3 mt-3"><code>curl -X POST http://localhost:5000/api/register \
  -F "name=John Doe" \
  -F "images=@image1.jpg" \
  -F "images=@image2.jpg"</code></pre>
            </div>
            
            <div class="api-endpoint">
                <h5><span class="badge bg-primary me-2">POST</span> /api/register-batch</h5>
                <p>Register faces from a list of base64 encoded images or URLs (not fully implemented).</p>
                <pre class="bg-light p-3 mt-3"><code>curl -X POST http://localhost:5000/api/register-batch \
  -H "Content-Type: application/json" \
  -d '{
    "name": "John Doe",
    "images": ["data:image/jpeg;base64,/9j/4AAQSkZJRgABAQ...", "http://example.com/image.jpg"]
  }'</code></pre>
            </div>
        </section>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-white py-4 mt-5">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h5>Face Recognition System</h5>
                    <p>Powered by Flask, PyTorch, and Bootstrap</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p class="mb-0">API Status: <span id="footerStatus">Checking...</span></p>
                    <p class="mb-0">Device: <span id="footerDevice">Unknown</span></p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // DOM elements
        const healthStatus = document.getElementById('healthStatus');
        const deviceInfo = document.getElementById('deviceInfo');
        const modelInfo = document.getElementById('modelInfo');
        const systemStatus = document.getElementById('systemStatus');
        const statusSpinner = document.getElementById('statusSpinner');
        const footerStatus = document.getElementById('footerStatus');
        const footerDevice = document.getElementById('footerDevice');
        const fileInput = document.getElementById('fileInput');
        const uploadArea = document.getElementById('uploadArea');
        const imagePreviews = document.getElementById('imagePreviews');
        const registerForm = document.getElementById('registerForm');
        const uploadProgress = document.getElementById('uploadProgress');
        const successAlert = document.getElementById('successAlert');
        const errorAlert = document.getElementById('errorAlert');
        const progressBar = document.querySelector('.progress-bar');

        // Check system health on page load
        document.addEventListener('DOMContentLoaded', function() {
            checkHealth();
            
            // Set up drag and drop
            setupDragAndDrop();
            
            // Set up file input change event
            fileInput.addEventListener('change', handleFileSelect);
        });

        // Health check function
        function checkHealth() {
            fetch('/api/health')
                .then(response => response.json())
                .then(data => {
                    // Update health status
                    if (data.status === 'healthy') {
                        healthStatus.innerHTML = `
                            <i class="fa-solid fa-circle-check fa-3x status-healthy"></i>
                            <p class="mt-2 fw-bold status-healthy">API is Healthy</p>
                        `;
                        systemStatus.textContent = 'System is operational';
                        systemStatus.className = 'status-healthy fw-bold';
                        statusSpinner.className = 'spinner-border me-2 status-healthy';
                        footerStatus.textContent = 'Healthy';
                        footerStatus.className = 'status-healthy';
                    } else {
                        healthStatus.innerHTML = `
                            <i class="fa-solid fa-circle-exclamation fa-3x status-unhealthy"></i>
                            <p class="mt-2 fw-bold status-unhealthy">API is Unhealthy</p>
                        `;
                        systemStatus.textContent = 'System has issues';
                        systemStatus.className = 'status-unhealthy fw-bold';
                        statusSpinner.className = 'spinner-border me-2 status-unhealthy';
                        footerStatus.textContent = 'Unhealthy';
                        footerStatus.className = 'status-unhealthy';
                    }
                    
                    // Update device info
                    deviceInfo.textContent = data.device;
                    footerDevice.textContent = data.device;
                    
                    // Update model info
                    modelInfo.textContent = data.model_loaded ? 'Loaded' : 'Not Loaded';
                    modelInfo.className = data.model_loaded ? 
                        'badge bg-success rounded-pill' : 'badge bg-danger rounded-pill';
                })
                .catch(error => {
                    healthStatus.innerHTML = `
                        <i class="fa-solid fa-circle-exclamation fa-3x status-unhealthy"></i>
                        <p class="mt-2 fw-bold status-unhealthy">API Connection Failed</p>
                        <p class="small">${error.message}</p>
                    `;
                    systemStatus.textContent = 'Cannot connect to API';
                    systemStatus.className = 'status-unhealthy fw-bold';
                    statusSpinner.className = 'spinner-border me-2 status-unhealthy';
                    footerStatus.textContent = 'Connection Failed';
                    footerStatus.className = 'status-unhealthy';
                    deviceInfo.textContent = 'Unknown';
                    modelInfo.textContent = 'Unknown';
                    modelInfo.className = 'badge bg-secondary rounded-pill';
                });
        }

        // Set up drag and drop
        function setupDragAndDrop() {
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                uploadArea.addEventListener(eventName, preventDefaults, false);
            });
            
            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }
            
            ['dragenter', 'dragover'].forEach(eventName => {
                uploadArea.addEventListener(eventName, highlight, false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                uploadArea.addEventListener(eventName, unhighlight, false);
            });
            
            function highlight() {
                uploadArea.classList.add('bg-light');
                uploadArea.style.borderColor = '#6a11cb';
            }
            
            function unhighlight() {
                uploadArea.classList.remove('bg-light');
                uploadArea.style.borderColor = '#ccc';
            }
            
            uploadArea.addEventListener('drop', handleDrop, false);
            
            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                handleFiles(files);
            }
        }

        // Handle file selection
        function handleFileSelect(e) {
            const files = e.target.files;
            handleFiles(files);
        }
        
        function handleFiles(files) {
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                if (!file.type.match('image.*')) continue;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.createElement('div');
                    preview.className = 'image-preview-container';
                    preview.innerHTML = `
                        <img src="${e.target.result}" class="preview-image">
                        <span class="remove-image" onclick="removeImage(this)">&times;</span>
                    `;
                    imagePreviews.appendChild(preview);
                }
                reader.readAsDataURL(file);
            }
        }
        
        // Remove image preview
        function removeImage(element) {
            element.parentElement.remove();
        }

        // Form submission
        registerForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('personName').value;
            const files = fileInput.files;
            
            if (!name) {
                showError('Please enter a name');
                return;
            }
            
            if (files.length === 0) {
                showError('Please select at least one image');
                return;
            }
            
            // Show progress
            uploadProgress.classList.remove('d-none');
            successAlert.classList.add('d-none');
            errorAlert.classList.add('d-none');
            
            // Create form data
            const formData = new FormData();
            formData.append('name', name);
            
            for (let i = 0; i < files.length; i++) {
                formData.append('images', files[i]);
            }
            
            // Send request
            fetch('/api/register', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showSuccess(`Successfully registered ${data.person_name} with ${data.successful_images} images`);
                    registerForm.reset();
                    imagePreviews.innerHTML = '';
                } else {
                    showError(data.error || 'Registration failed');
                }
                uploadProgress.classList.add('d-none');
            })
            .catch(error => {
                showError('Error: ' + error.message);
                uploadProgress.classList.add('d-none');
            });
            
            // Simulate progress for demo (would be replaced with actual progress events)
            let progress = 0;
            const interval = setInterval(() => {
                progress += 5;
                progressBar.style.width = `${progress}%`;
                document.getElementById('uploadStatus').textContent = `Processing... ${progress}%`;
                
                if (progress >= 100) {
                    clearInterval(interval);
                }
            }, 200);
        });
        
        // Show success message
        function showSuccess(message) {
            successAlert.textContent = message;
            successAlert.classList.remove('d-none');
            errorAlert.classList.add('d-none');
        }
        
        // Show error message
        function showError(message) {
            errorAlert.textContent = message;
            errorAlert.classList.remove('d-none');
            successAlert.classList.add('d-none');
        }
    </script>
</body>
</html>